
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Filters &amp; Filter Chains | Turnpike</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css"/>
    <link rel="stylesheet" href="_static/yammerdoc.css" type="text/css"/>
    <link rel="top" title="Turnpike" href="index.html"/>
    <link rel="prev" title="Route Requests" href="route-requests.html"/>
    <style lang="text/css">
        #top-bar, #top-bar small, #top-bar a {
            text-shadow: 0px -1px 0px #182127;
            color: #ffffff;
        }
        
        #top-bar {
            background-color: #363F45;
            background-image: -moz-linear-gradient(top, #545d63, #182127);
            background-image: -ms-linear-gradient(top, #545d63, #182127);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#545d63), to(#182127));
            background-image: -webkit-linear-gradient(top, #545d63, #182127);
            background-image: -o-linear-gradient(top, #545d63, #182127);
            background-image: linear-gradient(top, #545d63, #182127);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#545d63', endColorstr = '#182127', GradientType = 0);
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
        }


        .hero-unit {
            background-image: url("_static/turnpike-logo.png") !important;
            background-repeat: no-repeat !important;
            background-position: 30px 50px;
        }

        .hero-unit div.section {
            padding-left: 150px !important;
        }
    </style>
</head>
<body>
    <a href="https://github.com/URXtech/turnpike-ios">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
             src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
             alt="Fork me on GitHub"></a>
    <div class="navbar">
        <div class="navbar-inner container-fluid" id="top-bar">
            <header class="row-fluid">
                <h1 class="span12" id="title"><img class="logo" src="_static/turnpike-logo.png" alt="Logo"/>
                    <a href="index.html">Turnpike</a>
                    <small>Structuring the web of mobile apps.</small>
                </h1>
            </header>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3" id="sidebar">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="enabling-mobile-deeplinking.html">Enabling Mobile Deeplinking</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapping-routes.html">Mapping Routes to Destinations</a></li>
<li class="toctree-l1"><a class="reference internal" href="route-requests.html">Route Requests</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Filters &amp; Filter Chains</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#filters">Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementing-a-filter">Implementing a Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processing-query-parameters-with-a-filter">Processing Query Parameters with a Filter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#anonymous-filters">Anonymous Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementing-an-anonymous-filter">Implementing an Anonymous Filter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filter-chain">Filter Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-inteface-with-the-filter-chain">How to inteface with the Filter Chain</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                <hr/>
            </div>
            <div class="span9" id="body">
                
  <div class="section" id="filters-filter-chains">
<h1>Filters &amp; Filter Chains</h1>
<p>Filters allow you to perform logic with the incoming Route Request before the route&#8217;s mapped destination is resolved. Filters can be used for authentication, redirecting, analytics, and more. Turnpike&#8217;s implementation of filters uses a simplified version of the <a class="reference external" href="http://www.oracle.com/technetwork/java/interceptingfilter-142169.html">intercepting filter</a> pattern.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The goal of routing filters is to reduce code duplication for cross-cutting concerns that should be evaluated on each incoming deeplink (for instance, tracking UTM campaign query parameters on inbound deeplinks).</p>
</div>
<p>Filters are processed sequentially in a <a class="reference internal" href="#fc-filter-chain"><em>Filter Chain</em></a>. Each <tt class="docutils literal"><span class="pre">Router</span></tt> has a single <tt class="docutils literal"><span class="pre">Filter</span> <span class="pre">Chain</span></tt>; each individual filter runs once on each request processed by the <tt class="docutils literal"><span class="pre">Router</span></tt>.</p>
<p>Filters can either be added to the filter chain in one of two ways:</p>
<ul class="simple">
<li><a class="reference internal" href="#fc-filters"><em>Filters</em></a> implementing <tt class="docutils literal"><span class="pre">TPFilterProtocol</span></tt> can be added using <tt class="docutils literal"><span class="pre">appendFilter</span></tt>.</li>
<li><a class="reference internal" href="#fc-anonymous-filters"><em>Anonymous Filters</em></a> can be defined with a block and added using <tt class="docutils literal"><span class="pre">appendAnonymousFilter</span></tt>.</li>
</ul>
<div class="section" id="filters">
<span id="fc-filters"></span><h2>Filters</h2>
<div class="section" id="implementing-a-filter">
<span id="fc-implementing-a-filter"></span><h3>Implementing a Filter</h3>
<p>Filters themselves are objects that respond to <tt class="docutils literal"><span class="pre">TPFilterProtocol</span></tt>, and as such implement the following method:</p>
<div class="highlight-objc"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">doFilterWithRequest:</span><span class="p">(</span><span class="n">TPRouteRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span> <span class="nf">AndFilterChain:</span><span class="p">(</span><span class="n">TPFilterChain</span> <span class="o">*</span><span class="p">)</span><span class="nv">filterChain</span>
</pre></div>
</div>
<p>This is the method that is used to process a <tt class="docutils literal"><span class="pre">TPRouteRequest</span></tt>. To pass processing on to the next filter, the active filter should call</p>
<div class="highlight-objc"><div class="highlight"><pre><span class="p">[</span><span class="n">filterChain</span><span class="p">.</span><span class="n">doFilterWithRequest</span><span class="o">:</span><span class="n">request</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="processing-query-parameters-with-a-filter">
<span id="fc-examples-processing-query-params"></span><h3>Processing Query Parameters with a Filter</h3>
<div class="highlight-objc"><div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">MyCouponFilter</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">doFilterWithRequest:</span><span class="p">(</span><span class="n">TPRouteRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span> <span class="nf">AndFilterChain:</span><span class="p">(</span><span class="n">TPFilterChain</span> <span class="o">*</span><span class="p">)</span><span class="nv">filterChain</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="n">valueForKey</span><span class="o">:</span><span class="s">@&quot;coupon_id&quot;</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">CouponProcessor</span> <span class="n">validateAndProcessCoupon</span><span class="o">:</span><span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="n">valueForKey</span><span class="o">:</span><span class="s">@&quot;coupon_id&quot;</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">filterChain</span><span class="p">.</span><span class="n">doFilterWithRequest</span><span class="o">:</span><span class="n">request</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="anonymous-filters">
<span id="fc-anonymous-filters"></span><h2>Anonymous Filters</h2>
<p>The <tt class="docutils literal"><span class="pre">TPAnonymousFilter</span></tt> is an object which responds to the <tt class="docutils literal"><span class="pre">TPFilterProtocol</span></tt>, and which lets the user of this object define the behavior of the filter through a block.</p>
<p><tt class="docutils literal"><span class="pre">TPAnonymousFilter</span></tt>&#8216;s are useful when making a filter to handle internal logic, where as creating your own class is useful when creating redistributable classes. The main advantage of <tt class="docutils literal"><span class="pre">TPAnonymousFilter</span></tt>&#8216;s is being able to avoid the boilerplate required for creating a new class.</p>
<div class="section" id="implementing-an-anonymous-filter">
<span id="fc-implementing-anonymous"></span><h3>Implementing an Anonymous Filter</h3>
<p>To use the <tt class="docutils literal"><span class="pre">TPAnonymousFilter</span></tt> you can create a filter object with the factory method <tt class="docutils literal"><span class="pre">+</span> <span class="pre">(id&lt;TPFilterProtocol&gt;)</span> <span class="pre">filterWithBlock:(TPFilterBlock)filterBlock</span></tt>.</p>
<div class="highlight-objc"><div class="highlight"><pre><span class="p">[</span><span class="n">Turnpike</span> <span class="n">addAnonymousFilter</span><span class="o">:^</span><span class="p">(</span><span class="n">TPRouteRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">,</span> <span class="n">TPFilterChain</span> <span class="o">*</span><span class="n">filterChain</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">matchedRoute</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">MyAwesomeLoggingService</span> <span class="n">logRoute</span><span class="o">:</span><span class="n">request</span><span class="p">.</span><span class="n">matchedRoute</span> <span class="n">WithParameters</span><span class="o">:</span><span class="n">request</span><span class="p">.</span><span class="n">routeParameters</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">filterChain</span> <span class="n">doFilterWithRequest</span><span class="o">:</span><span class="n">request</span><span class="p">];</span>
<span class="p">}];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="filter-chain">
<span id="fc-filter-chain"></span><h2>Filter Chain</h2>
<p>The <tt class="docutils literal"><span class="pre">TPFilterChain</span></tt> is a queue of filters which get processed as its created. In processing each filter, the filter can decide to continue or abandon the filter chain. Should each filter continue the filter chain until there are no more filters left, the <tt class="docutils literal"><span class="pre">TPRoutingCallback</span></tt> associated with the route from the <tt class="docutils literal"><span class="pre">TPRouteRequest</span></tt> is invoked and the chain is complete.</p>
<div class="section" id="how-to-inteface-with-the-filter-chain">
<h3>How to inteface with the Filter Chain</h3>
<p>Filter chains are created by a <tt class="docutils literal"><span class="pre">TPRouter</span></tt> when a route or URL is invoked. The filters in the filter chain are supplied by the router in the order in which they were added to the router.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The order of execution is defined by the order in which filters are added to the router (the first filter added is the first execute, the last is the last executed). Each filter passes the current request (after processing and/or modifying the request) to the next filter in the filter chain.</p>
</div>
<p>The typical way to interface with <tt class="docutils literal"><span class="pre">TPFilterChain</span></tt> is in your filter&#8217;s logic when creating a filter. In your filter logic, if you want to continue the filter chain with the current route, you need to call <tt class="docutils literal"><span class="pre">[filterChain</span> <span class="pre">doFilterWithRequest:request]</span></tt>. You should not need to call the <tt class="docutils literal"><span class="pre">TPFilterChain</span></tt>&#8216;s constructor, unless you are subclassing <tt class="docutils literal"><span class="pre">TPRouter</span></tt> in some special way.</p>
</div>
</div>
</div>


            </div>
        </div>
        <hr/>
        <footer>
            &copy; Copyright 2013, URX.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>
            1.2b1.
        </footer>
    </div>
</body>
</html>


