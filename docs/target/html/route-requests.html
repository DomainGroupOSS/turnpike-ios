
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Route Requests | Turnpike</title>
    <link rel="stylesheet" href="static/pygments.css" type="text/css"/>
    <link rel="stylesheet" href="static/yammerdoc.css" type="text/css"/>
    <link rel="top" title="Turnpike" href="index.html"/>
    <link rel="next" title="Filters &amp; Filter Chains" href="filter-chains.html"/>
    <link rel="prev" title="Mapping Routes to Destinations" href="mapping-routes.html"/>
    <style lang="text/css">
        #top-bar, #top-bar small, #top-bar a {
            text-shadow: 0px -1px 0px #182127;
            color: #ffffff;
        }
        
        #top-bar {
            background-color: #363F45;
            background-image: -moz-linear-gradient(top, #545d63, #182127);
            background-image: -ms-linear-gradient(top, #545d63, #182127);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#545d63), to(#182127));
            background-image: -webkit-linear-gradient(top, #545d63, #182127);
            background-image: -o-linear-gradient(top, #545d63, #182127);
            background-image: linear-gradient(top, #545d63, #182127);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#545d63', endColorstr = '#182127', GradientType = 0);
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
        }


        .hero-unit {
            background-image: url("static/turnpike-logo.png") !important;
            background-repeat: no-repeat !important;
            background-position: 30px 50px;
        }

        .hero-unit div.section {
            padding-left: 150px !important;
        }
    </style>
</head>
<body>
    <a href="https://github.com/URXtech/turnpike-ios">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
             src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
             alt="Fork me on GitHub"></a>
    <div class="navbar">
        <div class="navbar-inner container-fluid" id="top-bar">
            <header class="row-fluid">
                <h1 class="span12" id="title"><img class="logo" src="static/turnpike-logo.png" alt="Logo"/>
                    <a href="index.html">Turnpike</a>
                    <small>Structuring the web of mobile apps.</small>
                </h1>
            </header>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3" id="sidebar">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="enabling-mobile-deeplinking.html">Enabling Mobile Deeplinking</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapping-routes.html">Mapping Routes to Destinations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Route Requests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#deeplink-metadata">Deeplink Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#route-request-creation">Route Request Creation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="filter-chains.html">Filters &amp; Filter Chains</a></li>
</ul>

                <hr/>
            </div>
            <div class="span9" id="body">
                
  <div class="section" id="route-requests">
<span id="id1"></span><h1>Route Requests</h1>
<p>Route Requests hold data about the in-app session created as a user enters an app from a deeplink URI.</p>
<p>Requests have a lifecycle consisting of 3 stages:</p>
<ul class="simple">
<li><strong>Creation</strong>: Requests are created by the <tt class="docutils literal"><span class="pre">Router</span></tt> when resolving a route. See <a class="reference internal" href="#rr-route-request-creation"><em>below</em></a> for details.</li>
<li><strong>Filtration</strong>: Requests are passed through <a class="reference internal" href="filter-chains.html"><em>filters</em></a></li>
<li><strong>Resolution</strong>: After filtration, the <tt class="docutils literal"><span class="pre">Destination</span></tt> callback is invoked to navigate the user to a predefined page or action within the app.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">TPRouteRequest</span></tt> contains both external invocation specific information, as well as route specific information. If you are writing a route or filter, it is important to check for <tt class="docutils literal"><span class="pre">nil</span></tt> fields in the Route Request.</p>
<div class="section" id="deeplink-metadata">
<span id="rr-deeplink-metadata"></span><h2>Deeplink Metadata</h2>
<p>The <tt class="docutils literal"><span class="pre">urlSchema</span></tt> should be one of the custom URL schemas that <a class="reference internal" href="enabling-mobile-deeplinking.html"><em>your app has already registered</em></a> earlier in the Turnpike documentation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information about iOS deeplink support, please see &#8220;<a class="reference external" href="http://developer.apple.com/library/ios/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/AdvancedAppTricks/AdvancedAppTricks.html#//apple_ref/doc/uid/TP40007072-CH7-SW18">Implementing Custom URL Schemes</a>&#8221; in Apple&#8217;s Advanced App Tricks documentation).</p>
</div>
<p>Two of <tt class="docutils literal"><span class="pre">TPRouteRequest</span></tt>&#8216;s properties are used pass information specific to deeplink traffic from outside the app:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">urlSchema</span></tt></li>
<li><tt class="docutils literal"><span class="pre">queryParameters</span></tt></li>
</ul>
<div class="highlight-objc"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="n">valueForKey</span><span class="o">:</span><span class="s">@&quot;coupon_id&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">CouponProcessor</span> <span class="n">validateAndProcessCoupon</span><span class="o">:</span><span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span> <span class="n">valueForKey</span><span class="o">:</span><span class="s">@&quot;coupon_id&quot;</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">queryParameters</span></tt> are <tt class="docutils literal"><span class="pre">NSString</span></tt> key/value pairs parsed from the query string (if it has one). If you are inovking a route internally, this value will be nil.</p>
</div>
<div class="section" id="route-request-creation">
<span id="rr-route-request-creation"></span><h2>Route Request Creation</h2>
<p>During Request <strong>Creation</strong>, a <tt class="docutils literal"><span class="pre">Router</span></tt> attempts to find a matching route for an incoming deeplink URI, <tt class="docutils literal"><span class="pre">matchedRoute</span></tt> is set to the corresponding defined route (in route format, ie <tt class="docutils literal"><span class="pre">user/:user_id</span></tt>). If no match was found, the default route will be invoked and this will be <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
<p>After route matching, the <tt class="docutils literal"><span class="pre">Router</span></tt> parses out route parameters (from variables defined in dynamic routes) and query parameters. Query params and route params are passed into the new Request, along with the matched route and its destination. If the incoming route did not match any defined routes, a <tt class="docutils literal"><span class="pre">nil</span></tt> route will be passed into the request along with a default Destination.</p>
<div class="highlight-objc"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">matchedRoute</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">MyAwesomeLoggingService</span> <span class="n">logRoute</span><span class="o">:</span><span class="n">request</span><span class="p">.</span><span class="n">matchedRoute</span> <span class="n">WithParameters</span><span class="o">:</span><span class="n">request</span><span class="p">.</span><span class="n">routeParameters</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">routeParameters</span></tt> is an <tt class="docutils literal"><span class="pre">NSDictionary</span></tt> of route parameters found in the matched route. If no route parameters are found this will be an empty <tt class="docutils literal"><span class="pre">NSDictionary</span></tt>, and if no matched route was found, this will be <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</div>
</div>


            </div>
        </div>
        <hr/>
        <footer>
            &copy; Copyright 2013, URX.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>
            1.2b1.
        </footer>
    </div>
</body>
</html>


